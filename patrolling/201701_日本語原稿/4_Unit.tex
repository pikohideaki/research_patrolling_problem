
\section{{\unit}}
第1章で述べた通り，{\unit}はStarの特殊な場合とみなせるため，
定理\ref{theo:StarEqualProfitTimelimit}から
全点の利得と{\idletime}が等しい場合は
協力警邏問題を多項式時間で解くことができる．
{\unit}は一般的なStarよりすべての枝の長さが等しいより簡単な図形であるため，
定理\ref{theo:StarEqualProfitTimelimit}が
全点の利得が等しいという条件が無くても成り立つ
（すなわち，全点の{\idletime}が等しい場合は協力警邏問題を多項式時間で解ける）
ことを示す（定理\ref{theo:UnitEqualTimelimit}）．

{\idletime}が一般の場合については
多項式時間アルゴリズムやNP困難性を示すのが難しかったため，
第2章で扱った「訪問時刻指定問題」を再び考える．
グラフが{\unit}の場合は「訪問時刻指定問題」がNP困難になることを示す（定理\ref{}）．



\subsection{全点の{\idletime}が等しい場合}

\begin{theo}
  \label{theo:UnitEqualTimelimit}
  グラフの形状が{\unit}で全点の{\idletime}が等しい場合，
  協力警邏問題は（利得，巡査数が一般であっても）多項式時間で解くことができる．
\end{theo}

\begin{proof}
  補題\ref{lemm:condition_of_guarding_star}から
  {\unit}の全点の許容訪問間隔が$Q$のとき，
  点集合$V$の任意の部分集合$W$について
  $$
    \sum_{v \in W} \min(d, Q) = |W|\min(d, Q) \leq mQ
    \iff \text{$m$人の巡査により$W$の全点を警邏できる}
  $$
  が成り立つ．$d$は{\unit}の各辺の長さである．

  グラフの形状が{\unit}の場合，
  全点の許容訪問間隔が等しいならば警邏する部分集合$W$は利得の大きい点から選べばよい
  （利得のより大きい点$v_1$とより小さい点$v_2$があるとき，
  $v_1$を警備して$v_2$を警備しない運行は常に$v_1$を警備する代わりに$v_2$を警備する運行に変換できる）．
  $|W|\min(d, Q) \leq mQ$を満たす最大の$|W|$は
  $|W| = \left\lfloor {mQ}/{\min(d, Q)} \right\rfloor$
  であり，利得の大きい点から$\lfloor {mQ}/{\min(d, Q)} \rfloor$点を選ぶ計算は
  $O(\lfloor {mQ}/{\min(d, Q)} \rfloor \log n)$となる．
\end{proof}




\subsection{{\idletime}が一般の場合：訪問時刻指定問題}
\red{
    1. 最初の訪問時刻も指定されるときの{\patrolling}は独立点集合問題からの帰着でNP困難． \\
    2. 全点警備可能性判定なら1人のときはP（おまけ）. \\
    3. 最初の訪問時刻が指定されず自由度がある場合は
       Disjoint Residue Class Problem と同じ問題になるのでNP困難（おまけ）.
}


\begin{theo}
  \label{theo:unit_exacttime_NPhard}
  グラフの形状が{\unit}で，利得が一般のとき
  協力警邏問題（訪問時刻指定）はNP困難である．
\end{theo}


\begin{proof}[証明]
  最大独立点集合問題からの帰着による．

  最大独立点集合問題は，
  無向グラフが与えられたときに独立点集合で最大のものを求めるというNP完全問題である．
  この問題において，間に辺の存在する2頂点の両方を選ぶことはできないという制約を，
  協力警邏問題において2頂点のどちらか一方しか警備できないという制約に帰着する．

  % $G = (V, E)$
  グラフが{\unit}で巡査が一人，辺の長さが$1$である場合の訪問時刻指定の協力警邏問題を考える．


  辺の長さが$1$なので巡査の速さを$1$であれば2点間の移動にかかる時間は$1$となり，
  すべての整数の時刻にどれか1点を訪問できる．
  その上で，{\interval} $q_i$, 最初の訪問時刻 $r_i$ は整数，利得はすべて1とする．
  {\unit}の頂点集合は$V$とする．
  頂点$v_i$を警備するために訪問しなければならない時刻の列は
  $q_i k + r_i \; (k \in \N)$ で表される．
  すると，$v_i$ と $v_j$ の両方を警備できる必要十分条件は
  \[ q_i k + r_i = q_j l + r_j \]
  すなわち
  \[ r_i - r_j = q_j l - q_i k \]
  となる自然数 $k, l$ が存在しないこととなるが，
  これは $r_i - r_j = gcd(q_i,q_j) n$ となる整数 $n$ が存在しないことと同値である．
  よって，
  $v_i$ と $v_j$ の両方を警備できる必要十分条件は
  $r_i \not\equiv r_j \mod gcd(q_i, q_j)$
  となる．

  ここで，${}_n C_2$ 個の相異なる素数 $p_{ij} (1 \leq i < j \leq n)$ を用意し，
  各頂点の{\interval}を
  $q_i = p_{1i} p_{2i} \cdots p_{(i - 1)i} p_{i(i + 1)} \cdots p_{in}$
  とすると，$gcd(q_i,q_j) = p_{ij}$ （$i < j$ のとき）となり，
  先ほどの条件は
  $r_i \not\equiv r_j \mod p_{ij}$
  となる．

  $G$ において
  $(v_i, v_j) \in E$     ならば $r_i \equiv r_j \equiv 0 \mod p_{ij}$,
  $(v_i, v_j) \not\in E$ ならば $r_i \equiv 0, r_j \equiv 1 \mod p_{ij}$
  と定めると，
  各 $r_k$ に対して相異なる $n - 1$ 個の素数で割ったときの余りが与えられるので，
  中国剰余定理からそのような $r_k$ がその $n - 1$ 個の素数の積 $q_k$ を法として一意に存在することが言え，
  これにより，$(v_i, v_j) \in E$ ならば $r_i \equiv r_j \mod p_{ij}$
  $(v_i, v_j) \not\in E$ ならば $r_i \not\equiv r_j \mod p_{ij}$
  を満たすように各 $r_k$ を定めることができる

  最後に，${}_n C_2$ 個の相異なる素数を用意する計算量も確かめる必要がある．
  $k$ 番目に小さい素数を $P_k$ と書くと，$k \geq 6$ のときは
  $P_k < k( \ln k + \ln\ln k )$ であることが知られているため~\cite{dusart1999k}，
  $k( \ln k + \ln\ln k )$ までの自然数を順に素数かどうか判定していくことで
  $k$ 個以上の素数を得ることができる．
  ある数が素数であるかどうかを判定する多項式時間アルゴリズムは存在するので~\cite{agrawal2004primes}，
  ${}_n C_2$ 個の素数の列挙は$n$の多項式時間でできる．

  以上の手順で $q_k$ と $r_k$ を設定することにより，
  $G$ において最大の独立点集合を求める問題を，
  最初の訪問時刻が指定され周期ちょうど毎に訪問しなければならない問題で
  巡査が1人で全点の利得が等しい場合の{\patrolling}に帰着できた．
\end{proof}






% \subsubsection{{\interval}の場合}

% \begin{proof}[証明]
%     Disjoint Residue Class Problem~\cite{kawamura2015simple}からの帰着による．

%     ある整数のペアの集合 $\mathset{ (m_1, r_1), \ldots, (m_n, r_n) }$ が
%     Disjoint Residue Class であるとは，
%     任意の整数 $x$ に対して $x \equiv r_i \mod m_i$ となるような $i$ が
%     高々1つ存在することと定義される．
%     Disjoint Residue Class Problem とは
%     整数の組 $(m_1, \ldots, m_n)$ が与えられたときに，
%     $\mathset{ (m_1, r_1), \ldots, (m_n, r_n) }$ が
%     Disjoint Residue Class となるような組 $(r_1, \ldots, r_n)$ が
%     存在するかを判定する問題であり，
%     これはNP困難であることが知られている~\cite{kawamura2015simple}．

%     Disjoint Residue Class Problem は，
%     巡査1人，グラフの形状が{\unit}で
%     {\interval}ごとの時刻は必ず訪問しなければならないという制約での{\decisionpp}に多項式時間帰着できる．
%     Disjoint Residue Class Problem の入力が $(m_1, \ldots, m_n)$ のとき，
%     {\unit}で頂点を$V = \mathset{ v_1, \ldots, v_n }$, {\interval}を$q_i = m_i$, 辺の長さを$d = 1$ とする．
%     $d = 1$ より整数の時刻にいずれかの点を訪問できるようにする．
%     各頂点 $v_i$ の最初の訪問時刻を $r_i$ とすると，
%     この点を警備するために訪問しなければならない時刻の列は
%     $q_i k + r_i (k \in \N)$ で与えられるが，
%     全点を警備するためには任意の2点 $v_i, v_j \in V$ , 任意の整数 $k,l$ について
%     $q_i k + r_i \neq q_j l + r_j$
%     である必要がある．

%     % Disjoint Residue Class Problem が Yes ならば \decisionpp も Yes
%     Disjoint Residue Class Problem の解 $(r_1, \ldots, r_n)$ が存在するならば，
%     これにより任意の時刻 $t \in \Z$ に対して $t \equiv r_i \mod q_i$, 
%     すなわち $t = r_i + q_i k$ となる $k \in \Z$ が存在するような $i$ は高々1つであり，
%     任意の $k,l \in \Z$ に対して $q_i k + r_i \neq q_j l + r_j$ が成り立つので，
%     巡査は全点を警備できる．

%     % \decisionpp が Yes ならば Disjoint Residue Class Problem も Yes
%     逆に{\decisionpp}の解が存在するとき，
%     全点を警備できるのでその警邏において各頂点$v_i$を最初に訪問する時刻を $r_i$ とすると，
%     任意の $v_i,v_j \in V$, $k,l \in \Z$ に対し
%     \begin{equation}
%         \label{eq:patrollDisjoint}
%         q_i k + r_i \neq q_j l + r_j
%     \end{equation}
%     が成り立つ．すると，任意の時刻 $t \in \Z$ に対して
%     $t \equiv r_i \mod q_i$ となるような $i$ が2つ存在するとすると，
%     それを $i$, $j$ として
%     $t \equiv r_i \mod q_i$, $t \equiv r_j \mod q_j$
%     すなわち，ある整数 $k,l$ が存在して
%     $t = q_i k + r_i$, $t = q_j l + r_j$
%     となり，この $k,l$ によって
%     $q_i k + r_i = q_j l + r_j$ となり，式\ref{eq:patrollDisjoint} に矛盾する．
%     よって，任意の整数 $t$ に対して $t \equiv r_i \mod q_i$ を満たす
%     $i$ は高々1つであるような $r_i$ が与えられたので，
%     {\decisionpp}の解が存在するとき，
%     Disjoint Residue Class Problemにも解が存在する．

%     以上よりDisjoint Residue Class Problemを帰着できた．
% \end{proof}







% \subsubsection{最初の訪問時刻指定，{\interval}}
% 今，最初の訪問時刻には自由度があり{\interval}だけが指定される問題を考えたが，
% さらに最初の訪問時刻も与えられる問題も考えることができる．

% \begin{theo}
%     \label{theo:UnitSingleExactStarttime}
%     グラフの形状が{\unit}で巡査が1人の場合，
%     最初の訪問時刻と{\interval}が与えられて
%     最初の訪問時刻からその{\interval}ごとの時刻は必ず訪問しなければならないという問題の場合，
%     {\decisionpp}はPである．
% \end{theo}

% \begin{proof}[証明]
%     まず，{\unit}の辺の長さを$d$とする．
%     各$i$について正整数$q _i$と整数$r _i$とが与えられ，
%         集合$S _i = \{\, q_i k + r_i : k \in \Z \,\}$に属する時刻に
%         頂点$v _i$を訪問することが要求される．
%     \red{（定義済？→）}{\decisionpp}がYesである（＝全点を警備できる）ことは，
%     連続した訪問しなければならない時刻の差がすべて移動時間$d$以上であること，すなわち
%     任意の相異なる$i$，$j$について
%         $S _i$に属するどの時刻と
%         $S _j$に属するどの時刻も差が$d$以上であることを意味する．
%     これは任意の2頂点$v_i, v_j \in V$と
%     任意の整数$k,l$に対して$\abs{ (q_i k + r_i ) - (q_j l + r_j) } \geq d$という条件となり\red{（←「$(i, k) = (j, l)$の場合を除いて」が必要？）}，これは
%     任意の整数$n$に対して$\abs{ (r_i - r_j) + gcd(q_i, q_j) n } \geq d$と同値であり，
%     左辺の最小値を考えると
%     $\abs{ r_i - r_j }$を$gcd(q_i, q_j)$で割った余り$a$と
%     $gcd(q_i, q_j) - a$ のうち小さい方が$d$以上かを計算すればよい．
%     この計算は定数時間であり
%     ${}_n C_2$ 通りこれを調べればよい．
% \end{proof}




% {\decisionpp}で巡査を複数とすると，$T$ に差が $d$ 未満の整数が含まれていても
% 複数の巡査によりそれぞれ訪問できる場合が生じるため難しい．



% {\decisionpp}では巡査が1人ならば多項式時間アルゴリズムが存在したが，
% 一方{\patrolling}は巡査が1人でも（複数人でも）NP困難となる．

% \begin{theo}
%     \label{theo:UnitExactStarttimeNPhard}
%     グラフの形状が{\unit}で，
%     最初の訪問時刻と{\interval}が与えられたときに，
%     最初の訪問時刻からその{\interval}ごとの時刻は必ず訪問しなければならないという問題の場合，
%     巡査が1人で全点の利得が等しい場合でも{\patrolling}はNP困難である．
% \end{theo}

